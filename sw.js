const CACHE_NAME="storymap-v1",urlsToCache=["/","/index.html","/app.bundle.js","/app.css","/favicon.png","/images/logo.png"];self.addEventListener("install",(e=>{console.log("Service Worker: Installing..."),e.waitUntil(caches.open(CACHE_NAME).then((e=>(console.log("Service Worker: Caching files"),e.addAll(urlsToCache)))).catch((e=>{console.error("Service Worker: Cache failed",e)}))),self.skipWaiting()})),self.addEventListener("activate",(e=>(console.log("Service Worker: Activating..."),e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>{if(e!==CACHE_NAME)return console.log("Service Worker: Deleting old cache",e),caches.delete(e)})))))),self.clients.claim()))),self.addEventListener("fetch",(e=>{e.respondWith(caches.match(e.request).then((t=>t||fetch(e.request).then((t=>{if(!e.request.url.includes("/v1/")){const i=t.clone();caches.open(CACHE_NAME).then((t=>{t.put(e.request,i)}))}return t})).catch((()=>{if("document"===e.request.destination)return caches.match("/index.html")})))))})),self.addEventListener("push",(e=>{console.log("Service Worker: Push notification received");let t={title:"StoryMap",body:"Anda memiliki notifikasi baru",icon:"/images/logo.png",badge:"/images/logo.png",tag:"storymap-notification",requireInteraction:!1};if(e.data)try{const i=e.data.json();t={title:i.title||t.title,body:i.body||t.body,icon:i.icon||t.icon,badge:i.badge||t.badge,tag:i.tag||t.tag,data:i.data||{}}}catch(i){t.body=e.data.text()}e.waitUntil(self.registration.showNotification(t.title,{body:t.body,icon:t.icon,badge:t.badge,tag:t.tag,data:t.data}))})),self.addEventListener("notificationclick",(e=>{console.log("Service Worker: Notification clicked"),e.notification.close(),e.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((e=>{for(let t of e)if("/"===t.url&&"focus"in t)return t.focus();if(clients.openWindow)return clients.openWindow("/")})))}));