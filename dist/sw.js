const CACHE_NAME="storymap-v1",getBasePath=()=>{const e=self.location.pathname;return e.substring(0,e.lastIndexOf("/")+1)},basePath=getBasePath(),urlsToCache=[basePath,basePath+"index.html",basePath+"app.bundle.js",basePath+"app.css",basePath+"favicon.png",basePath+"images/logo.png"];self.addEventListener("install",(e=>{console.log("Service Worker: Installing..."),e.waitUntil(caches.open(CACHE_NAME).then((e=>(console.log("Service Worker: Caching files"),e.addAll(urlsToCache)))).catch((e=>{console.error("Service Worker: Cache failed",e)}))),self.skipWaiting()})),self.addEventListener("activate",(e=>(console.log("Service Worker: Activating..."),e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>{if(e!==CACHE_NAME)return console.log("Service Worker: Deleting old cache",e),caches.delete(e)})))))),self.clients.claim()))),self.addEventListener("fetch",(e=>{e.respondWith(caches.match(e.request).then((t=>t||fetch(e.request).then((t=>{if(!e.request.url.includes("/v1/")){const a=t.clone();caches.open(CACHE_NAME).then((t=>{t.put(e.request,a)}))}return t})).catch((()=>{if("document"===e.request.destination)return caches.match(basePath+"index.html")})))))})),self.addEventListener("push",(e=>{console.log("Service Worker: Push notification received");let t={title:"StoryMap",body:"Anda memiliki notifikasi baru",icon:basePath+"images/logo.png",badge:basePath+"images/logo.png",tag:"storymap-notification",requireInteraction:!1};if(e.data)try{const a=e.data.json();t={title:a.title||t.title,body:a.body||t.body,icon:a.icon||t.icon,badge:a.badge||t.badge,tag:a.tag||t.tag,data:a.data||{}}}catch(a){t.body=e.data.text()}e.waitUntil(self.registration.showNotification(t.title,{body:t.body,icon:t.icon,badge:t.badge,tag:t.tag,data:t.data}))})),self.addEventListener("notificationclick",(e=>{console.log("Service Worker: Notification clicked"),e.notification.close(),e.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((e=>{for(let t of e)if(t.url.includes(basePath)&&"focus"in t)return t.focus();if(clients.openWindow)return clients.openWindow(basePath)})))}));